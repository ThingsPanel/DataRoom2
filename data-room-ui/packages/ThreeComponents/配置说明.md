## Three.js 组件配置说明 (通用指南)

### 1. 组件概述

本指南旨在说明 DataRoom 中基于 Three.js 的 3D 可视化组件的通用配置原则。这些组件能够加载 3D 模型并在场景中展示与数据绑定的动态信息点或效果。

每个具体的 Three.js 组件（如“桥梁实时监测”、“PM2.5监测器”）会有其特定的 3D 模型、监测点定义以及可配置的选项。

### 2. 组件标识信息

每个组件都在其定义文件（`.js` 文件）的顶部包含一些基本标识信息，用于系统识别和分类：

*   **版本 (`version`):** 组件配置的版本号。
*   **标题 (`title`):** 在组件选择列表中显示的名称。
*   **分类 (`category`):** 组件所属的类别（例如 "3D模型"）。
*   **名称 (`name`):** 系统内部使用的唯一标识符，通常与组件定义文件名或文件夹名一致。
*   **图表类型 (`chartType`):** 固定为 `threeJs`，表明这是一个 Three.js 组件。

这些值对于每个组件都是特定的。

### 3. 数据配置 (`setting` - `tabName: 'data'`)

此配置面板用于**将你的数据源中的字段映射到该组件内部预期的数据输入点**。

*   **所需字段:** 具体需要映射哪些数据字段，以及这些字段的含义（例如，"结构应力"、"PM2.5值"），完全取决于**当前配置的组件**。请查阅该组件的具体文档或其 `.js` 文件中的 `setting` 部分（`tabName: 'data'`）来确定需要绑定哪些字段。
    *   *示例：* "桥梁监测"组件需要绑定结构应力、位移等多个字段，而"PM2.5监测器"只需要绑定一个 PM2.5 数值字段。
*   **数据处理 (`dataHandler`)**: 一些组件可能包含一个 `dataHandler` 脚本，用于在数据绑定后、渲染前对数据进行预处理。
    *   *示例（桥梁监测）:* `dataHandler` 可能用于解析一个包含多个数值的逗号分隔字符串，并将其分配给不同的内部数据点。
    *   *示例（PM2.5监测器）:* `dataHandler` 可能为空，表示不进行额外的数据处理。
    *   **重要提示:** `dataHandler` 的行为（如果有）对如何准备和绑定数据至关重要。请务必检查具体组件 `.js` 文件中的 `dataHandler` 代码或相关说明。

#### 3.1 数据格式与绑定场景示例

以下是一些可能的数据绑定场景，具体适用哪种取决于组件的 `dataHandler` 实现：

*   **场景A：单一字段包含多信息（需要特定 `dataHandler` 解析）**
    *   *数据源示例:* `[{ "value": "125,6,3,10.2,810" }]`
    *   *配置:* 可能需要将组件要求的所有数据字段选择器都指向这个 `value` 字段。
    *   *前提:* 组件的 `dataHandler` 必须编写了按约定顺序（例如，桥梁监测中的固定顺序）解析此逗号分隔字符串的逻辑。
*   **场景B：为每个信息提供独立字段（通常无需复杂 `dataHandler`）**
    *   *数据源示例:* `[{ "stress_reading": 115, "vertical_displacement": 4.8, ... }]`
    *   *配置:* 将组件的每个数据字段选择器分别指向数据源中对应的字段（例如，`结构应力数据字段` -> `stress_reading`）。
    *   *行为:* 组件直接使用映射字段的值，`dataHandler` 通常为空或进行简单转换。

请根据你所使用的具体组件及其 `dataHandler` 行为选择合适的配置方式。

### 4. 自定义样式配置 (`setting` - `tabName: 'custom'`)

此配置面板用于调整组件的视觉外观、交互行为和特定功能选项。

*   **可用选项:** **可用的配置项及其分组 (`groupName`) 会因组件的不同而有很大差异。**
    *   *示例：* "桥梁监测"提供了针对特定标签（如结构应力标签）的字号、背景色等精细控制；而"PM2.5监测器"则提供了模型旋转速度、整体缩放和Y轴位置等模型控制选项。
*   **常见配置类别 (具体选项依组件而定):**
    *   **环境 (`groupName: '环境'`)**: 如背景颜色、是否启用阴影。
    *   **光照 (`groupName: '光照'`)**: 如环境光强度、方向光强度。
    *   **相机 (`groupName: '相机'`)**: 如初始相机位置、目标点、缩放级别、是否启用阻尼。
    *   **动画 (`groupName: '动画'`)**: 如模型自动旋转速度。
    *   **模型 (`groupName: '模型'`)**: 如模型整体缩放、位置调整。
    *   **标签/信息点样式**: 如全局标签偏移、碰撞间距，或特定标签的样式（字体、颜色等）。
    *   **状态颜色 (`groupName: '状态颜色'`)**: 定义不同数据状态（如正常、警告、危险）对应的颜色。

请参考具体组件在"自定义样式"面板中提供的选项进行配置。

### 5. 内部配置 (`option` 对象)

组件的 `.js` 文件中定义了一个 `option` 对象，它存储了组件运行所需的所有配置信息，包括默认值以及通过上述UI面板修改后的值。

*   **`option.data`**: 通常用于存储（或初始化为 `null`）经过 `dataHandler` 处理后，最终用于渲染的数据。
*   **`option.customize`**: 这是核心配置对象，包含：
    *   **`modelPath`**: **(组件特定)** 指向要加载的 3D 模型文件（例如 `.glb` 格式）。
    *   **`dataPoints`**: **(组件特定)** 一个数组，定义了场景中的监测点或信息点。每个点通常包含：
        *   `id`: 唯一标识符。
        *   `name`: 显示名称。
        *   `position`: 在 3D 空间中的坐标 (`{x, y, z}`)。
        *   `dataStructure`: 包含该点具体数据项的数组。每个数据项通常有：
            *   `bindingKey`: **(关键)** 与"数据配置"面板中字段绑定的内部键名。
            *   `unit`: 单位。
            *   `defaultValue`: 默认值。
            *   `thresholds`: 定义状态（正常/警告/危险）的数值阈值，用于决定状态颜色。结构可能为 `{ normal: [min, max], warning: [min, max], dangerMin: value }` 等。
            *   `currentValue`: (运行时更新) 当前值。
            *   `style`: 特定样式。
        *   `description`: 描述文本。
    *   **`binding`**: 存储从内部 `bindingKey` 到"数据配置"面板选定的数据源字段名的映射。
    *   **其他配置**: 如环境、光照、相机、状态颜色等，与"自定义样式"面板的设置对应。

*   **`optionHandler`**: 组件定义中可能包含一个 `optionHandler` 脚本字符串。如果非空，它会在配置更新后执行，用于处理复杂的选项间依赖或动态计算。对于许多组件，此项为空。

理解 `option.customize` 特别是 `dataPoints` 和 `bindingKey` 的结构对于正确配置数据至关重要。

### 6. 默认/示例数据

组件的 `.js` 定义文件可能包含一个顶层的 `data` 常量或在 `option.data` 中提供初始值。这通常用于组件开发调试或提供一个无数据源时的默认展示。在实际使用中，组件将依赖于通过"数据配置"面板连接的数据源。

### 7. 查看具体组件的配置示例

由于每个 Three.js 组件的配置（尤其是 `option.customize` 内的 `dataPoints` 结构和可用的自定义样式选项）都是特定的，**本通用指南不提供具体的完整配置 JSON 示例。**

**要了解某个特定组件（如"桥梁实时监测"或"PM2.5监测器"）的完整默认配置结构，请直接查阅其对应的 `.js` 定义文件。** 文件中导出的 `option` 对象即是该组件的默认配置蓝图。

---

**总结:** 配置 Three.js 组件的关键在于理解其特定的数据需求（需要绑定哪些字段，`dataHandler` 如何工作）和可用的自定义选项。请务必参考你正在使用的**具体组件的 `.js` 定义文件或其配套文档**，以获取最准确的配置信息。 